<main style="padding: 1rem; margin-top: 1rem;">
  <% if @event.races.nil? %>

  <% else %>
  <% if policy(@event).edit? %>
    <%= link_to "Edit this event", edit_event_path(@event) %>
  <% end %>
  <% if user_signed_in? && policy(@event).new? %>
    <%= link_to "New event", new_event_path %>
  <% end %>
  <%= button_to "Destroy this event", @event, method: :delete if policy(@event).destroy? %>

  <% if user_signed_in? && policy(Race).create? %>
    <%= link_to "Create a new race", new_event_race_path(@event) %>
  <% end %>

  <div class="grid">
    <div class="race-event-name">
      <%= @event.name %>
    </div>
    <% @event.races.each do |race| %>
      <article class="card-race product-item">
        <div class="card__image_race">
          <% if race.photos.attached? %>
            <% race.photos.each do |photo| %>
              <%= cl_image_tag photo.key, class: "image-class" %>
            <% end %>
          <% end %>
        </div>
        <header class="card__header">
          <h1 class="product__title"> <%= race.name %> </h1>
        </header>
        <div class="card__content">
          <h2 class="product__address"> <%= race.address %> </h2>
          <p  class="product__description"> <%= race.date %> </p>
        </div>
        <% if policy(race).edit? %>
          <%= link_to "Edit this race", edit_event_race_path(@event, race.id) %>
        <% end %>
        <%= button_to "Destroy this race", event_race_path(event_id: race.event_id, id: race.id), method: :delete if policy(race).destroy? %>
      </article>
      <% end %>
    <% end %>
  </div>
</main>


